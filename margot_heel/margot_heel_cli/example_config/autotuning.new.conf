<margot>


  <block name="my_block_name">



    <!-- MONITOR SECTION -->
    <monitor name="my_frequency_monitor" type="Frequency">
      <expose var_name="avg_frequency" what="average" />
    </monitor>

    <monitor name="my_memory_monitor" type="Memory">
      <expose var_name="avg_memory" what="average" />
    </monitor>

    <monitor name="my_l1miss_monitor" type="PAPI">
      <creation>
        <param name="event">
          <fixed value="margot::PapiEvent::L1_MISS"/>
        </param>
      </creation>
      <expose var_name="avg_l1miss" what="average" />
    </monitor>

    <monitor name="my_proc_cpu_usage_monitor" type="CPUPROCESS">
      <expose var_name="avg_usage_proc" what="average" />
    </monitor>

    <monitor name="my_sys_cpu_usage_monitor" type="CPUSYSTEM">
      <expose var_name="avg_usage_sys" what="average" />
    </monitor>

    <monitor name="my_temperature_monitor" type="Temperature">
      <expose var_name="avg_temperature" what="average" />
    </monitor>

    <monitor name="my_throughput_monitor" type="throughput">
      <stop>
        <param name="num_job_done">
          <local_var name="data" type="double" />
        </param>
      </stop>
      <expose var_name="avg_throughput" what="average" />
    </monitor>

    <monitor name="my_time_monitor" type="Time">
      <creation>
        <param name="time_measure">
          <fixed value="margot::TimeUnit::Milliseconds"/>
        </param>
      </creation>
      <expose var_name="avg_time" what="average" />
    </monitor>

    <monitor name="my_collector_monitor" type="Collector">
      <creation>
        <param name="topic_of_interest">
          <fixed value='"antarex/testcluster/testnode/#"' />
        </param>
        <param name="broker_address">
          <fixed value='"127.0.0.1"'/>
        </param>
        <param name="broker_port">
          <fixed value="1883"/>
        </param>
      </creation>
      <expose var_name="avg_topic" what="average" />
    </monitor>

    <monitor name="my_custom_monitor" type="custom">
      <spec>
        <header reference="margot/monitor.hpp" />
        <class name="margot::Monitor&lt; float &gt;" />
        <type name="float" />
        <stop_method name="push" />
      </spec>
      <stop>
        <param name="error">
          <local_var name="error" type="float" />
        </param>
      </stop>
      <expose var_name="avg_quality" what="average" />
    </monitor>


    <!-- SW-KNOB SECTION -->
    <knob name="num_threads" var_name="threads" var_type="int"/>
    <knob name="skip_factor" var_name="skip1" var_type="int"/>


    <!-- METRIC SECTION -->
    <metric name="throughput" type="float" distribution="yes"/>
    <metric name="quality" type="float" distribution="yes"/>
    <metric name="frequency" type="float" />
    <metric name="temperature" type="float" />


    <!-- GOAL SECTION -->
    <goal name="my_param_goal"      knob_name="skip_factor" cFun="LT" value="2" />
    <goal name="my_throughput_goal" metric_name="throughput"  cFun="GE" value="100" />


    <!-- RUNTIME INFORMATION PROVIDER -->
    <adapt metric_name="throughput" using="my_throughput_monitor" inertia="1" />


    <!-- OPTIMIZATION SECTION -->
    <state name="my_optimization_1" starting="yes" >

      <maximize combination="linear">
        <knob name="num_threads" coef="1.0"/>
        <metric name="quality" coef="2.0"/>
      </maximize>

      <subject to="my_throughput_goal" confidence="3" priority="30" />
      <subject to="my_param_goal"      confidence="3" priority="20" />
    </state>

  </block>




</margot>
